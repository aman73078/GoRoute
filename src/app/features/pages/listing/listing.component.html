<main class="bg-gray-100 min-h-screen font-['Inter'] py-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-md mb-8 border-l-4 border-red-600">

                    <div class="flex flex-col sm:flex-row justify-between items-center">

                        <h1 class="text-xl font-bold text-gray-800">

                            <span class="text-red-600">{{ source() }}</span> to <span class="text-red-600">{{ destination() }}</span>

                        </h1>

                        <div class="text-lg text-gray-600 mt-2 sm:mt-0">

                            <span class="font-semibold">{{ date() }}</span> | <span class="text-sm font-medium">{{ availableBuses().length }} Buses Found</span>

                        </div>

                        <button (click)="toggleModifySearch()" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition duration-200 mt-4 sm:mt-0">

                            Modify Search

                        </button>

                    </div>

        

                    <div *ngIf="showModifySearch()" class="mt-4 pt-4 border-t border-gray-200">

                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">

                            <div>

                                <label for="source" class="block text-sm font-medium text-gray-700">From</label>

                                <input type="text" id="source" [value]="source()" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">

                            </div>

                            <div>

                                <label for="destination" class="block text-sm font-medium text-gray-700">To</label>

                                <input type="text" id="destination" [value]="destination()" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">

                            </div>

                            <div>

                                <label for="date" class="block text-sm font-medium text-gray-700">Date</label>

                                <input type="date" id="date" [value]="date()" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">

                            </div>

                        </div>

                        <div class="text-right mt-4">

                            <button (click)="updateSearch()" class="bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition duration-200">

                                Update Search

                            </button>

                        </div>

                    </div>

                </div>

        <div class="bg-gradient-to-r from-red-500 to-yellow-500 p-6 rounded-xl shadow-lg mb-8 text-white relative overflow-hidden">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-extrabold">Flash Sale!</h2>
                    <p class="mt-1 text-red-100">Get up to <span class="font-bold">{{ maxDiscount() }}% OFF</span> on selected bus tickets. Limited time offer!</p>
                </div>
                <button class="bg-white text-red-600 font-bold py-2 px-5 rounded-lg shadow-md hover:bg-red-100 transition-all transform hover:scale-105">
                    View Deals
                </button>
            </div>
            <div class="absolute -bottom-10 -right-8 text-white/20">
                <svg class="w-40 h-40" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6c0 1.888.864 3.542 2.193 4.65A8.001 8.001 0 0118 10a6 6 0 00-6-6zm-3.75 9.5a.75.75 0 000 1.5h7.5a.75.75 0 000-1.5h-7.5z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
            </div>
        </div>





        <div class="flex flex-col lg:flex-row gap-8">

            <aside class="lg:w-1/4">
                <div class="bg-white p-6 rounded-xl shadow-lg sticky top-5 border border-gray-200">
                    <div class="flex justify-between items-center mb-4 border-b pb-2">
                        <h2 class="text-xl font-bold text-gray-800">Filter Results</h2>
                        <button (click)="clearFilters()" class="text-sm text-red-600 hover:text-red-800 font-semibold transition-colors">
                            Clear All
                        </button>
                    </div>

                    <div class="mb-5 border-b pb-4">
                        <h3 class="font-semibold text-gray-700 mb-3">Price Range</h3>
                        <input type="range" [min]="0" [max]="1500" [value]="filterState().maxPrice"
                            (input)="onMaxPriceChange($event)" step="50"
                            class="w-full h-2 bg-red-100 rounded-lg appearance-none cursor-pointer range-lg">
                        <div class="flex justify-between text-sm text-gray-500 mt-1">
                            <span>â‚¹0</span>
                            <span class="font-bold text-red-600">Max: â‚¹{{ filterState().maxPrice }}</span>
                        </div>
                    </div>

                    <div class="mb-5 border-b pb-4">
                        <h3 class="font-semibold text-gray-700 mb-3">Bus Type</h3>
                        <div class="space-y-2">
                            <label *ngFor="let type of ['AC', 'Non-AC']"
                                class="flex items-center text-gray-600 text-sm cursor-pointer group">
                                <input type="checkbox" [checked]="filterState().type.includes(type)"
                                    (change)="toggleFilter('type', type)"
                                    class="form-checkbox h-4 w-4 text-red-600 rounded border-gray-300 focus:ring-red-500 mr-2 transition-all duration-150 group-hover:scale-110">
                                {{ type }}
                            </label>
                        </div>
                    </div>

                    <div class="mb-5 border-b pb-4">
                        <h3 class="font-semibold text-gray-700 mb-3">Seater Type</h3>
                        <div class="space-y-2">
                            <label *ngFor="let seater of ['Sleeper', 'Seater']"
                                class="flex items-center text-gray-600 text-sm cursor-pointer group">
                                <input type="checkbox" [checked]="filterState().seater.includes(seater)"
                                    (change)="toggleFilter('seater', seater)"
                                    class="form-checkbox h-4 w-4 text-red-600 rounded border-gray-300 focus:ring-red-500 mr-2 transition-all duration-150 group-hover:scale-110">
                                {{ seater }}
                            </label>
                        </div>
                    </div>

                    <div class="mb-0">
                        <h3 class="font-semibold text-gray-700 mb-3">Operators</h3>
                        <div class="space-y-2 max-h-40 overflow-y-auto pr-2 custom-scrollbar">
                            <label *ngFor="let operator of operators"
                                class="flex items-center text-gray-600 text-sm cursor-pointer group">
                                <input type="checkbox" [checked]="filterState().operators.includes(operator.id)"
                                    (change)="toggleFilter('operators', operator.id)"
                                    class="form-checkbox h-4 w-4 text-red-600 rounded border-gray-300 focus:ring-red-500 mr-2 transition-all duration-150 group-hover:scale-110">
                                {{ operator.name }}
                            </label>
                        </div>
                    </div>
                </div>
            </aside>

            <section class="lg:w-3/4">
                <div class="bg-white p-4 rounded-xl shadow-md mb-6 flex items-center justify-between gap-4 relative">
                    <div class="flex items-center gap-4">
                        <span class="text-gray-600 font-medium text-sm hidden sm:block">Sort By:</span>
                        <button (click)="setSort('departure')" [class.bg-red-600]="sortBy() === 'departure'"
                            [class.text-white]="sortBy() === 'departure'" [class.bg-gray-200]="sortBy() !== 'departure'"
                            [class.text-gray-700]="sortBy() !== 'departure'"
                            class="px-3 py-1 text-sm font-semibold rounded-full transition duration-150">
                            Departure Time
                            <span *ngIf="sortBy() === 'departure'">
                                {{ sortOrder() === 'asc' ? 'â†‘' : 'â†“' }}
                            </span>
                        </button>
                        <button (click)="setSort('price')" [class.bg-red-600]="sortBy() === 'price'"
                            [class.text-white]="sortBy() === 'price'" [class.bg-gray-200]="sortBy() !== 'price'"
                            [class.text-gray-700]="sortBy() !== 'price'"
                            class="px-3 py-1 text-sm font-semibold rounded-full transition duration-150">
                            Price
                            <span *ngIf="sortBy() === 'price'">
                                {{ sortOrder() === 'asc' ? 'â†‘' : 'â†“' }}
                            </span>
                        </button>
                        <button (click)="setSort('rating')" [class.bg-red-600]="sortBy() === 'rating'"
                            [class.text-white]="sortBy() === 'rating'" [class.bg-gray-200]="sortBy() !== 'rating'"
                            [class.text-gray-700]="sortBy() !== 'rating'"
                            class="px-3 py-1 text-sm font-semibold rounded-full transition duration-150">
                            Rating
                            <span *ngIf="sortBy() === 'rating'">
                                {{ sortOrder() === 'desc' ? 'â†‘' : 'â†“' }}
                            </span>
                        </button>
                    </div>

                    <div (click)="toggleFirstTimeDiscount()" class="coupon-container">
                        <div class="coupon" [class.applied]="firstTimeDiscountApplied()">
                            <div class="coupon-cutout"></div>
                            <div class="coupon-content">
                                <span *ngIf="!firstTimeDiscountApplied()" class="text-sm font-bold">FIRST10</span>
                                <span *ngIf="firstTimeDiscountApplied()" class="text-sm font-bold">APPLIED!</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <ng-container *ngIf="availableBuses().length > 0; else noBuses">
                        <div *ngFor="let bus of availableBuses(); let i = index"
                            class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-200/80 animate-fade-in-up transition-all duration-300 hover:shadow-xl"
                            [style.animation-delay]="i * 100 + 'ms'">
                            <div class="p-5 grid grid-cols-12 gap-4 items-center">

                                <div class="col-span-8">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-xl font-bold text-gray-800">{{ getOperatorName(bus.operatorId) }}</h3>
                                        <div class="flex items-center gap-3">
                                            <span class="flex items-center text-sm font-semibold text-yellow-500">
                                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.817 2.052a1 1 0 00-.363 1.118l1.07 3.292c.3.921-.755 1.683-1.54 1.118l-2.817-2.052a1 1 0 00-1.175 0l-2.817 2.052c-.784.565-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.721c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                                {{ bus.rating.toFixed(1) }}
                                            </span>
                                            <span *ngIf="bus.discountPercentage" class="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 rounded-full">{{ bus.discountPercentage }}% OFF</span>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">{{ bus.type }} / {{ bus.seater }}</p>

                                    <div class="flex items-center justify-between mt-4 text-center">
                                        <div>
                                            <p class="text-lg font-semibold text-gray-700">{{ bus.departureTime }}</p>
                                            <p class="text-xs text-gray-500">{{ source() }}</p>
                                        </div>
                                        <div class="text-center text-gray-400 px-2">
                                            <p class="text-xs font-semibold">{{ bus.duration }}</p>
                                            <div class="w-16 h-px bg-gray-200 my-1"></div>
                                        </div>
                                        <div>
                                            <p class="text-lg font-semibold text-gray-700">{{ bus.arrivalTime }}</p>
                                            <p class="text-xs text-gray-500">{{ destination() }}</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-span-4 text-center border-l border-gray-200/80 pl-4">
                                    <div *ngIf="bus.discountPercentage">
                                        <p class="text-md text-gray-500 line-through">â‚¹{{ bus.price }}</p>
                                        <p class="text-2xl font-extrabold text-red-600">â‚¹{{ calculateDiscountedPrice(bus.price, bus.discountPercentage) | number:'1.0-0' }}</p>
                                    </div>
                                    <p *ngIf="!bus.discountPercentage" class="text-2xl font-extrabold text-red-600">â‚¹{{ bus.price }}</p>
                                    <p class="text-xs font-semibold text-green-600 mt-1">{{ bus.availableSeats }} Seats Left</p>
                                    <button (click)="bookNow(bus)" class="mt-3 w-full bg-red-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-60 transition-all transform hover:scale-105">
                                        <span class="flex items-center justify-center">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg>
                                            View Seats
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </ng-container>

                    <ng-template #noBuses>
                        <div
                            class="bg-yellow-50 border border-yellow-300 text-yellow-800 p-6 rounded-xl text-center shadow-lg">
                            <p class="text-xl font-semibold mb-2">ðŸ˜” No Buses Found</p>
                            <p>Try adjusting your filters or search for a different date.</p>
                        </div>
                    </ng-template>

                </div>
            </section>
        </div>
    </div>
</main>